"use strict";const inputElement=document.querySelector(".js-search-input"),btnSearch=document.querySelector(".js-search-button"),labelMsgError=document.querySelector(".js-msg-error"),favoritesSection=document.querySelector(".js-favorites"),searchResultsSection=document.querySelector(".js-results-section"),searchCardClass="search-item-result",favCardClass="fav-item",removeBtnClass="remove-btn",resetBtnClass="reset-btn",favMarkedBgColor="#ffa600",favMarkedTextColor="#fff";let searchList=[],favList=[];const defaultImage="./assets/images/img-not-found.png",defaultUrl="https://api.tvmaze.com/search/shows?q=Neko";function savedDefaultPageLocalStorage(){const e=JSON.parse(localStorage.getItem("defaultPage"));null===e?queryApiPrintResults(defaultUrl):(searchList=e,reprintSearchList())}function savedFavsLocalStorage(){const e=JSON.parse(localStorage.getItem("favList"));null!==e&&(favList=e,reprintFavsUpdtLocStrg())}function docQuerySelAll(e){const t="."+e;return document.querySelectorAll(t)}function addClickListeners(e,t){const r=docQuerySelAll(e);for(const e of r)e.addEventListener("click",t)}function indexInFav(e){return favList.findIndex(t=>t.id===parseInt(e.id))}function findInSearchList(e){return searchList.find(t=>t.id===parseInt(e.id))}function createNewCard(e,t,r,n,a){const s=document.createElement("img");s.setAttribute("src",n),s.setAttribute("alt",a);const o=document.createElement("p"),c=document.createTextNode(r);o.appendChild(c);const i=document.createElement("li");return i.setAttribute("class",e),i.setAttribute("id",t),i.appendChild(s),i.appendChild(o),i}function renderSerieCard(e,t){const r=e.id,n=e.title;return createNewCard(t,r,n,e.image,e.image===defaultImage?"Serie sin imagen":"Imagen de "+n)}function printList(e,t,r){e.textContent="";const n=document.createElement("ul");for(const e of t){const t=renderSerieCard(e,r);n.appendChild(t)}e.appendChild(n)}function createButton(e,t){const r=document.createElement("button"),n=document.createTextNode(e);return r.setAttribute("class",t),r.appendChild(n),r}function addRemoveFavButtons(e){const t=docQuerySelAll(e);for(const e of t){const t=createButton("x","remove-btn");e.appendChild(t),addClickListeners("remove-btn",handleRemoveFavButton)}}function addResetFavButton(){const e=createButton("Eliminar todos tus favoritos","reset-btn");0===favList.length?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled"),favoritesSection.firstElementChild.appendChild(e),addClickListeners("reset-btn",handleResetButton)}function checkAndColorSrchCardsInFavs(){const e=docQuerySelAll(searchCardClass);for(const t of e){-1!==indexInFav(t)?(t.style.backgroundColor="#ffa600",t.style.color="#fff"):(t.style.color="",t.style.backgroundColor="")}}function reprintFavsUpdtLocStrg(){printList(favoritesSection,favList,"fav-item"),addRemoveFavButtons("fav-item"),addResetFavButton(),checkAndColorSrchCardsInFavs(),localStorage.setItem("favList",JSON.stringify(favList))}function reprintSearchList(){printList(searchResultsSection,searchList,searchCardClass),addClickListeners(searchCardClass,handleClickInSearchCards),checkAndColorSrchCardsInFavs()}function msgError(e){const t=document.createTextNode("Ha sucedido un error: "+e);labelMsgError.appendChild(t)}function urlUserSearch(){labelMsgError.textContent="";const e=inputElement.value,t="//api.tvmaze.com/search/shows?q="+e;return""===e&&msgError("Â¡No has buscado nada!"),t}function queryApiPrintResults(e){searchList=[],fetch(e).then(e=>e.json()).then(t=>{for(const e of t){let t={};t.id=e.show.id,t.title=e.show.name,t.image=null===e.show.image?defaultImage:e.show.image.medium,searchList.push(t)}e===defaultUrl&&localStorage.setItem("defaultPage",JSON.stringify(searchList)),reprintSearchList()}).catch(e=>{msgError(e)})}function handleClickInSearchCards(e){const t=e.currentTarget,r=findInSearchList(t),n=indexInFav(t);-1===n?favList.push(r):favList.splice(n,1),reprintFavsUpdtLocStrg()}function handleRemoveFavButton(e){const t=indexInFav(e.currentTarget.parentElement);favList.splice(t,1),reprintFavsUpdtLocStrg()}function handleResetButton(){favList=[],reprintFavsUpdtLocStrg()}function handleClickSearch(e){e.preventDefault(),queryApiPrintResults(urlUserSearch())}btnSearch.addEventListener("click",handleClickSearch),savedDefaultPageLocalStorage(),savedFavsLocalStorage();